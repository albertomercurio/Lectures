<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alberto Mercurio">

<title>QuantumToolbox.jl – Lectures</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-9c9e9b2a67e3636cc35070be350131dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Lectures</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-quantumtoolbox.jl" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">QuantumToolbox.jl</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-quantumtoolbox.jl">    
        <li>
    <a class="dropdown-item" href="../QuantumToolbox.jl/introduction.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../QuantumToolbox.jl/package_comparison.html">
 <span class="dropdown-text">Comparison with other packages</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/albertomercurio/Lectures" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#a-demo-code-the-schrödinger-equation" id="toc-a-demo-code-the-schrödinger-equation" class="nav-link" data-scroll-target="#a-demo-code-the-schrödinger-equation">A Demo Code: the Schrödinger Equation</a>
  <ul class="collapse">
  <li><a href="#the-qutip-case" id="toc-the-qutip-case" class="nav-link" data-scroll-target="#the-qutip-case">The QuTiP case</a></li>
  <li><a href="#quantumtoolbox.jl-almost-the-same-syntax" id="toc-quantumtoolbox.jl-almost-the-same-syntax" class="nav-link" data-scroll-target="#quantumtoolbox.jl-almost-the-same-syntax">QuantumToolbox.jl: Almost the same syntax</a></li>
  </ul></li>
  <li><a href="#the-quantumobject-struct" id="toc-the-quantumobject-struct" class="nav-link" data-scroll-target="#the-quantumobject-struct">The <code>QuantumObject</code> struct</a></li>
  <li><a href="#large-hilbert-spaces-the-need-for-gpu-acceleration" id="toc-large-hilbert-spaces-the-need-for-gpu-acceleration" class="nav-link" data-scroll-target="#large-hilbert-spaces-the-need-for-gpu-acceleration">Large Hilbert Spaces: The Need for GPU Acceleration</a>
  <ul class="collapse">
  <li><a href="#the-vectorized-representation-of-the-density-matrix" id="toc-the-vectorized-representation-of-the-density-matrix" class="nav-link" data-scroll-target="#the-vectorized-representation-of-the-density-matrix">The vectorized representation of the density matrix</a></li>
  <li><a href="#simulation-of-the-master-equation-on-the-cpu" id="toc-simulation-of-the-master-equation-on-the-cpu" class="nav-link" data-scroll-target="#simulation-of-the-master-equation-on-the-cpu">Simulation of the master equation on the CPU</a></li>
  <li><a href="#simulation-of-the-master-equation-on-the-gpu" id="toc-simulation-of-the-master-equation-on-the-gpu" class="nav-link" data-scroll-target="#simulation-of-the-master-equation-on-the-gpu">Simulation of the master equation on the GPU</a></li>
  </ul></li>
  <li><a href="#massive-parallelization-of-quantum-trajectories" id="toc-massive-parallelization-of-quantum-trajectories" class="nav-link" data-scroll-target="#massive-parallelization-of-quantum-trajectories">Massive Parallelization of quantum trajectories</a></li>
  <li><a href="#visualization-of-quantum-states" id="toc-visualization-of-quantum-states" class="nav-link" data-scroll-target="#visualization-of-quantum-states">Visualization of Quantum States</a>
  <ul class="collapse">
  <li><a href="#gpu-acceleration-for-the-wigner-function" id="toc-gpu-acceleration-for-the-wigner-function" class="nav-link" data-scroll-target="#gpu-acceleration-for-the-wigner-function">GPU Acceleration for the Wigner function</a></li>
  </ul></li>
  <li><a href="#current-features" id="toc-current-features" class="nav-link" data-scroll-target="#current-features">Current features</a></li>
  <li><a href="#system-information" id="toc-system-information" class="nav-link" data-scroll-target="#system-information">System Information</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">QuantumToolbox.jl</h1>
<p class="subtitle lead">A pure Julia framework for high-performance simulation of quantum systems</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alberto Mercurio </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p><a href="https://github.com/qutip/QuantumToolbox.jl">QuantumToolbox.jl</a> was born during my Ph.D., driven by the need for a high-performance framework for quantum simulations. At the time, I was already using <a href="https://github.com/qutip/qutip">QuTiP</a> (Quantum Toolbox in Python).</p>
<iframe src="https://qutip.org" width="100%" height="500px"></iframe>
<p>However, I was looking for a more efficient solution. I initially explored <a href="https://github.com/qojulia/QuantumOptics.jl">QuantumOptics.jl</a>, but its syntax differed significantly from QuTiP’s, which made the transition challenging. Motivated by the desire for both performance and familiarity, as well as a deep curiosity to learn Julia, I decided to develop my own package.</p>
</section>
<section id="a-demo-code-the-schrödinger-equation" class="level2">
<h2 class="anchored" data-anchor-id="a-demo-code-the-schrödinger-equation">A Demo Code: the Schrödinger Equation</h2>
<p>Let’s consider a quantum harmonic oscillator with Hamiltonian (<span class="math inline">\(\hbar = 1\)</span>)</p>
<p><span class="math display">\[
\hat{H} = \omega_0 \hat{a}^\dagger \hat{a} \, ,
\]</span></p>
<p>and start from the state</p>
<p><span class="math display">\[
\left| \psi(0) \right\rangle = \frac{1}{\sqrt{2}} \left( \left| 2 \right\rangle + \left| 3 \right\rangle \right) \, .
\]</span></p>
<p>We now want to solve the Schrödinger equation</p>
<p><span class="math display">\[
i \frac{d}{dt} \left| \psi(t) \right\rangle = \hat{H} \left| \psi(t) \right\rangle \, .
\]</span></p>
<p>This can easily be done with QuTiP using the <code>sesolve</code> function. We also want to compute the expectation value of the position operator</p>
<p><span class="math display">\[
\left\langle \hat{a} + \hat{a}^\dagger \right\rangle (t) = \left\langle \psi(t) \right| \hat{a} + \hat{a}^\dagger \left| \psi(t) \right\rangle \, .
\]</span></p>
<p>An analytical solution is known,</p>
<p><span class="math display">\[
\vert \psi (t) \rangle = \frac{1}{\sqrt{2}} \left( e^{-i 2 \omega_0 t} \vert 2 \rangle + e^{-i 3 \omega_0 t} \vert 3 \rangle \right) \, ,
\]</span></p>
<p>and so</p>
<p><span class="math display">\[
\langle \hat{a} + \hat{a}^\dagger \rangle (t) = \sqrt{3} \cos (\omega_0 t) \, ,
\]</span></p>
<p>and we can compare the numerical results with it.</p>
<section id="the-qutip-case" class="level3">
<h3 class="anchored" data-anchor-id="the-qutip-case">The QuTiP case</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">from</span> qutip <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>N <span class="op">=</span> <span class="dv">10</span> <span class="co"># cutoff for Fock states</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>a <span class="op">=</span> destroy(N)</span>
<span id="cb1-6"><a href="#cb1-6"></a>H <span class="op">=</span> a.dag() <span class="op">*</span> a</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>psi0 <span class="op">=</span> (fock(N, <span class="dv">2</span>) <span class="op">+</span> fock(N, <span class="dv">3</span>)).unit()</span>
<span id="cb1-9"><a href="#cb1-9"></a>tlist <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a>e_ops <span class="op">=</span> [a <span class="op">+</span> a.dag()]</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>result <span class="op">=</span> sesolve(H, psi0, tlist, e_ops<span class="op">=</span>e_ops)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="quantumtoolbox.jl-almost-the-same-syntax" class="level3">
<h3 class="anchored" data-anchor-id="quantumtoolbox.jl-almost-the-same-syntax">QuantumToolbox.jl: Almost the same syntax</h3>
<div id="2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">using</span> <span class="bu">QuantumToolbox</span></span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>N <span class="op">=</span> <span class="fl">10</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>a <span class="op">=</span> <span class="fu">destroy</span>(N)</span>
<span id="cb2-5"><a href="#cb2-5"></a>H <span class="op">=</span> a<span class="op">'</span> <span class="op">*</span> a</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a>psi0 <span class="op">=</span> (<span class="fu">fock</span>(N, <span class="fl">2</span>) <span class="op">+</span> <span class="fu">fock</span>(N, <span class="fl">3</span>)) <span class="op">|&gt;</span> normalize</span>
<span id="cb2-8"><a href="#cb2-8"></a>tlist <span class="op">=</span> <span class="fu">range</span>(<span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">100</span>)</span>
<span id="cb2-9"><a href="#cb2-9"></a>e_ops <span class="op">=</span> [a <span class="op">+</span> a<span class="op">'</span>]</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a>result <span class="op">=</span> <span class="fu">sesolve</span>(H, psi0, tlist, e_ops<span class="op">=</span>e_ops)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Progress: [==============================] 100.0% --- Elapsed Time: 0h 00m 00s (ETA: 0h 00m 00s)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Solution of time evolution
(return code: Success)
--------------------------
num_states = 1
num_expect = 1
ODE alg.: OrdinaryDiffEqTsit5.Tsit5{typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!), Static.False}(OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, static(false))
abstol = 1.0e-8
reltol = 1.0e-6</code></pre>
</div>
</div>
<p>And we can plot the results using <a href="https://github.com/MakieOrg/Makie.jl">Makie.jl</a> for example</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">700</span>, <span class="fl">300</span>), fontsize<span class="op">=</span><span class="fl">20</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"Time"</span>, ylabel<span class="op">=</span>L<span class="st">"\langle \hat{a} + \hat{a}^\dagger </span><span class="sc">\r</span><span class="st">angle"</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="fu">lines!</span>(ax, result.times, <span class="fu">real</span>.(result.expect[<span class="fl">1</span>,<span class="op">:</span>]), linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">"Numerical"</span>)</span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="fu">lines!</span>(ax, result.times, <span class="fu">sqrt</span>(<span class="fl">3</span>) <span class="op">.*</span> <span class="fu">cos</span>.(result.times), linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">"Analytical"</span>, linestyle<span class="op">=:</span>dash)</span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="fu">xlims!</span>(ax, result.times[<span class="fl">1</span>], result.times[<span class="kw">end</span>])</span>
<span id="cb5-10"><a href="#cb5-10"></a></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="fu">axislegend</span>(ax)</span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="introduction_files/figure-html/cell-3-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-quantumobject-struct" class="level2">
<h2 class="anchored" data-anchor-id="the-quantumobject-struct">The <code>QuantumObject</code> struct</h2>
<p>If we take a look at the structure of the annihilation operator <span class="math inline">\(\hat{a}\)</span>, we can see that it is a <a href="https://qutip.org/QuantumToolbox.jl/stable/resources/api#QuantumToolbox.QuantumObject"><code>QuantumObject</code></a> Julia constructor.</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">typeof</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>QuantumObject{SparseMatrixCSC{ComplexF64, Int64}, OperatorQuantumObject, 1}</code></pre>
</div>
</div>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1"></a>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Quantum Object:   type=Operator   dims=[10]   size=(10, 10)   ishermitian=false
10×10 SparseMatrixCSC{ComplexF64, Int64} with 9 stored entries:
     ⋅      1.0+0.0im          ⋅      …          ⋅          ⋅    
     ⋅          ⋅      1.41421+0.0im             ⋅          ⋅    
     ⋅          ⋅              ⋅                 ⋅          ⋅    
     ⋅          ⋅              ⋅                 ⋅          ⋅    
     ⋅          ⋅              ⋅                 ⋅          ⋅    
     ⋅          ⋅              ⋅      …          ⋅          ⋅    
     ⋅          ⋅              ⋅                 ⋅          ⋅    
     ⋅          ⋅              ⋅         2.82843+0.0im      ⋅    
     ⋅          ⋅              ⋅                 ⋅      3.0+0.0im
     ⋅          ⋅              ⋅                 ⋅          ⋅    </code></pre>
</div>
</div>
<p>A <code>QuantumObject</code> struct is defined as follows</p>
<div id="10" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">struct</span> QuantumObject{MT<span class="op">&lt;:</span><span class="dt">AbstractArray</span>,ObjType<span class="op">&lt;:</span><span class="dt">QuantumObjectType</span>,N} <span class="op">&lt;:</span><span class="dt"> AbstractQuantumObject{MT,ObjType,N}</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>    data<span class="op">::</span><span class="dt">MT</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="kw">type</span><span class="op">::</span><span class="dt">ObjType</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>    dims<span class="op">::</span><span class="dt">SVector{N,Int}</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>data</code> field contains the actual data of the quantum object, in this case it is a sparse matrix. This follows from the definition of the matrix elements of the annihilation operator</p>
<p><span class="math display">\[
\langle n \vert \hat{a} \vert m \rangle = \sqrt{m} \ \delta_{n, m-1} \, ,
\]</span></p>
<p>where we defined <span class="math inline">\(N\)</span> as the cutoff for the Fock states. The <code>type</code> field gives the type of the quantum object</p>
<ul>
<li><a href="https://qutip.org/QuantumToolbox.jl/stable/resources/api#QuantumToolbox.KetQuantumObject"><code>Ket</code></a> for ket states</li>
<li><a href="https://qutip.org/QuantumToolbox.jl/stable/resources/api#QuantumToolbox.BraQuantumObject"><code>Bra</code></a> for bra states</li>
<li><a href="https://qutip.org/QuantumToolbox.jl/stable/resources/api#QuantumToolbox.OperatorQuantumObject"><code>Operator</code></a> for operators</li>
<li><a href="https://qutip.org/QuantumToolbox.jl/stable/resources/api#QuantumToolbox.SuperOperatorQuantumObject"><code>SuperOperator</code></a> for superoperators (e.g., Liouvillian)</li>
<li><a href="https://qutip.org/QuantumToolbox.jl/stable/resources/api#QuantumToolbox.OperatorKetQuantumObject"><code>OperatorKet</code></a> for vectorized representation of operators, acting as a ket state</li>
<li><a href="https://qutip.org/QuantumToolbox.jl/stable/resources/api#QuantumToolbox.OperatorBraQuantumObject"><code>OperatorBra</code></a> for vectorized representation of operators, acting as a bra state</li>
</ul>
<p>Finally, the <code>dims</code> field contains the list of dimensions of the Hilbert spaces. Its length is equal to the number of subsystems, and each element is the dimension of the corresponding subsystem.</p>
</section>
<section id="large-hilbert-spaces-the-need-for-gpu-acceleration" class="level2">
<h2 class="anchored" data-anchor-id="large-hilbert-spaces-the-need-for-gpu-acceleration">Large Hilbert Spaces: The Need for GPU Acceleration</h2>
<p>The example above was quite simple, where an analytical solution was known. However, in many cases, the system is more complex and even the numerical solution can be challenging. For instance, the Hilbert space dimension can be very large when considering many subsystems. Let’s make a practical example by considering a transverse field Ising model with 10 spins. The Hamiltonian is given by</p>
<p><span id="eq-transverse-field-ising"><span class="math display">\[
\hat{H} = \frac{J_z}{2} \sum_{\langle i,j \rangle} \hat{\sigma}_i^z \hat{\sigma}_j^z + h_x \sum_i \hat{\sigma}_i^x \, ,
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(\hat{\sigma}_i^z\)</span> and <span class="math inline">\(\hat{\sigma}_i^x\)</span> are the Pauli matrices acting on the <span class="math inline">\(i\)</span>-th spin. Since we are including losses, the time evolution of the density matrix is governed by the Lindblad master equation</p>
<p><span id="eq-master-equation"><span class="math display">\[
\frac{d}{d t} \hat{\rho} = \mathcal{L}[\hat{\rho}] = -i[\hat{H}, \hat{\rho}] + \sum_k \left( \hat{L}_k \hat{\rho} \hat{L}_k^\dagger - \frac{1}{2} \{\hat{L}_k^\dagger \hat{L}_k, \hat{\rho}\} \right) \, ,
\tag{2}\]</span></span></p>
<p>with the dissipators</p>
<p><span id="eq-transverse-field-ising-dissipators"><span class="math display">\[
\hat{L}_k = \sqrt{\gamma} \hat{\sigma}_k^- \, ,
\tag{3}\]</span></span></p>
<p>where <span class="math inline">\(\hat{\sigma}_k^-\)</span> is the lowering operator acting on the <span class="math inline">\(k\)</span>-th spin, and <span class="math inline">\(\gamma\)</span> the decay rate.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.uni-ulm.de/fileadmin/_processed_/9/a/csm_OpenQuanutmSystems_vonMichael_54018bec90.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption>An open quantum system interacting with the many degrees of freedom of its surrounding environment.</figcaption>
</figure>
</div>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1"></a>N <span class="op">=</span> <span class="fl">10</span> <span class="co"># Total number of spins</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>Jz <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>hx <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>γ <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a>σx <span class="op">=</span> <span class="fu">sigmax</span>()</span>
<span id="cb11-7"><a href="#cb11-7"></a>σz <span class="op">=</span> <span class="fu">sigmaz</span>()</span>
<span id="cb11-8"><a href="#cb11-8"></a>σm <span class="op">=</span> <span class="fu">sigmam</span>()</span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co"># Efficient way to generate the operator on the i-th spin</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="kw">function</span> <span class="fu">op_i</span>(op, i, <span class="op">::</span><span class="dt">Val{N}</span>) <span class="kw">where</span> N</span>
<span id="cb11-12"><a href="#cb11-12"></a>    data <span class="op">=</span> <span class="fu">kron</span>(<span class="fu">qeye</span>(<span class="fl">2</span><span class="op">^</span>(i<span class="op">-</span><span class="fl">1</span>)).data, op.data, <span class="fu">qeye</span>(<span class="fl">2</span><span class="op">^</span>(N<span class="op">-</span>i)).data)</span>
<span id="cb11-13"><a href="#cb11-13"></a>    <span class="kw">type</span> <span class="op">=</span> Operator</span>
<span id="cb11-14"><a href="#cb11-14"></a>    dims <span class="op">=</span> <span class="fu">ntuple</span>(x <span class="op">-&gt;</span> <span class="fl">2</span>, <span class="fu">Val</span>(N))</span>
<span id="cb11-15"><a href="#cb11-15"></a></span>
<span id="cb11-16"><a href="#cb11-16"></a>    <span class="cf">return</span> <span class="fu">Qobj</span>(data, <span class="kw">type</span> <span class="op">=</span> <span class="kw">type</span>, dims <span class="op">=</span> dims)</span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="kw">end</span></span>
<span id="cb11-18"><a href="#cb11-18"></a></span>
<span id="cb11-19"><a href="#cb11-19"></a>H <span class="op">=</span> Jz <span class="op">/</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu">mapreduce</span>(i <span class="op">-&gt;</span> <span class="fu">op_i</span>(σz, i, <span class="fu">Val</span>(N)) <span class="op">*</span> <span class="fu">op_i</span>(σz, i <span class="op">+</span> <span class="fl">1</span>, <span class="fu">Val</span>(N)), <span class="op">+</span>, <span class="fl">1</span><span class="op">:</span>N<span class="op">-</span><span class="fl">1</span>) <span class="op">+</span> hx <span class="op">*</span> <span class="fu">mapreduce</span>(i <span class="op">-&gt;</span> <span class="fu">op_i</span>(σx, i, <span class="fu">Val</span>(N)), <span class="op">+</span>, <span class="fl">1</span><span class="op">:</span>N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Quantum Object:   type=Operator   dims=[2, 2, 2, 2, 2, 2, 2, 2, 2, 2]   size=(1024, 1024)   ishermitian=true
1024×1024 SparseMatrixCSC{ComplexF64, Int64} with 11264 stored entries:
⎡⣿⣿⣾⢦⡀⠳⣄⠀⠀⠀⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎤
⎢⠺⣟⢻⣶⣿⡂⠈⠳⣄⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⢤⡈⠻⠻⠿⣧⣤⣠⡈⠳⠄⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠙⢦⡀⠀⣻⣿⣿⣙⣦⡀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠙⢦⡈⠳⣼⣿⣿⡆⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠙⢦⡀⠀⠀⠁⠀⠈⠈⠉⣿⣿⣾⢦⡀⠳⣄⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠺⣟⢻⣶⣿⡂⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⢤⡈⠻⠻⠿⣧⣤⣠⡈⠳⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠙⢦⡀⠀⣻⣿⣿⣙⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠙⢦⡈⠳⣼⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⎥
⎢⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⡟⢦⡈⠳⣄⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⣍⣿⣿⣯⠀⠈⠳⣄⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢦⡈⠋⠛⢻⣶⣦⣦⡈⠓⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠨⣿⠿⣧⣽⡦⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠀⠀⠙⢦⠈⠳⡿⣿⣿⣀⡀⡀⠀⢀⠀⠀⠈⠳⣄⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠸⣿⣿⡟⢦⡈⠳⣄⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠈⠻⣍⣿⣿⣯⠀⠈⠳⣄⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠐⢦⡈⠋⠛⢻⣶⣦⣦⡈⠓⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠙⢦⡀⠨⣿⠿⣧⣽⡦⎥
⎣⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⠀⠀⠀⠙⢦⠈⠳⡿⣿⣿⎦</code></pre>
</div>
</div>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1"></a>c_ops <span class="op">=</span> <span class="fu">mapreduce</span>(i <span class="op">-&gt;</span> <span class="fu">sqrt</span>(γ) <span class="op">*</span> <span class="fu">op_i</span>(σm, i, <span class="fu">Val</span>(N)), vcat, <span class="fl">1</span><span class="op">:</span>N);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="the-vectorized-representation-of-the-density-matrix" class="level3">
<h3 class="anchored" data-anchor-id="the-vectorized-representation-of-the-density-matrix">The vectorized representation of the density matrix</h3>
<p>The Liouvillian <span class="math inline">\(\mathcal{L}\)</span> is a superoperator, meaning that it acts on operators. A convenient way to represent its action on <span class="math inline">\(\hat{\rho}\)</span> is by vectorizing the density matrix</p>
<p><span class="math display">\[
\hat{\rho} =
\begin{pmatrix}
\rho_{11} &amp; \rho_{12} &amp; \cdots &amp; \rho_{1N} \\
\rho_{21} &amp; \rho_{22} &amp; \cdots &amp; \rho_{2N} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\rho_{N1} &amp; \rho_{N2} &amp; \cdots &amp; \rho_{NN}
\end{pmatrix}
\rightarrow
\begin{pmatrix}
\rho_{11} \\
\rho_{21} \\
\vdots \\
\rho_{N1} \\
\rho_{12} \\
\rho_{22} \\
\vdots \\
\rho_{N2} \\
\vdots \\
\rho_{1N} \\
\rho_{2N} \\
\vdots \\
\rho_{NN}
\end{pmatrix} \, .
\]</span></p>
<p>In this framework, the Liouvillian is represented by a matrix, and it is generally used when solving the master equation in <a href="#eq-master-equation" class="quarto-xref">Equation&nbsp;2</a>.</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1"></a>L <span class="op">=</span> <span class="fu">liouvillian</span>(H, c_ops)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Quantum Object:   type=SuperOperator   dims=[2, 2, 2, 2, 2, 2, 2, 2, 2, 2]   size=(1048576, 1048576)
1048576×1048576 SparseMatrixCSC{ComplexF64, Int64} with 24641535 stored entries:
⎡⣿⣿⣾⢦⡀⠳⣄⠀⠀⠀⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎤
⎢⠺⣟⢻⣶⣿⡂⠈⠳⣄⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⢤⡈⠻⠻⠿⣧⣤⣠⡈⠳⠄⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠙⢦⡀⠀⣻⣿⣿⣙⣦⡀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠙⢦⡈⠳⣼⣿⣿⡆⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠙⢦⡀⠀⠀⠁⠀⠈⠈⠉⣿⣿⣾⢦⡀⠳⣄⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠺⣟⢻⣶⣿⡂⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⢤⡈⠻⠻⠿⣧⣤⣠⡈⠳⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠙⢦⡀⠀⣻⣿⣿⣙⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠙⢦⡈⠳⣼⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⎥
⎢⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⡟⢦⡈⠳⣄⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⣍⣿⣿⣯⠀⠈⠳⣄⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢦⡈⠋⠛⢻⣶⣦⣦⡈⠓⠀⠀⠀⠈⠳⣄⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠨⣿⠿⣧⣽⡦⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠀⠀⠙⢦⠈⠳⡿⣿⣿⣀⡀⡀⠀⢀⠀⠀⠈⠳⣄⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠸⣿⣿⡟⢦⡈⠳⣄⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠈⠻⣍⣿⣿⣯⠀⠈⠳⣄⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠐⢦⡈⠋⠛⢻⣶⣦⣦⡈⠓⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠙⢦⡀⠨⣿⠿⣧⣽⡦⎥
⎣⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⠀⠀⠀⠙⢦⠈⠳⡿⣿⣿⎦</code></pre>
</div>
</div>
</section>
<section id="simulation-of-the-master-equation-on-the-cpu" class="level3">
<h3 class="anchored" data-anchor-id="simulation-of-the-master-equation-on-the-cpu">Simulation of the master equation on the CPU</h3>
<p>Let’s simulate the dynamics of the system.</p>
<div id="18" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1"></a>ψ<span class="fl">0</span> <span class="op">=</span> <span class="fu">mapreduce</span>(i <span class="op">-&gt;</span> i <span class="op">==</span> <span class="fl">1</span> ? <span class="fu">basis</span>(<span class="fl">2</span>, <span class="fl">1</span>) <span class="op">:</span> <span class="fu">basis</span>(<span class="fl">2</span>, <span class="fl">0</span>), tensor, <span class="fl">1</span><span class="op">:</span>N)</span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>tlist <span class="op">=</span> <span class="fu">range</span>(<span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">100</span>)</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a>e_ops <span class="op">=</span> [<span class="fu">mapreduce</span>(i <span class="op">-&gt;</span> <span class="fu">op_i</span>(σz, i, <span class="fu">Val</span>(N)), <span class="op">+</span>, <span class="fl">1</span><span class="op">:</span>N)]</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="fu">mesolve</span>(L, ψ<span class="fl">0</span>, tlist[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>], e_ops<span class="op">=</span>e_ops, progress_bar<span class="op">=</span><span class="fu">Val</span>(<span class="cn">false</span>)) <span class="co"># warm-up</span></span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="pp">@time</span> result <span class="op">=</span> <span class="fu">mesolve</span>(L, ψ<span class="fl">0</span>, tlist, e_ops<span class="op">=</span>e_ops, progress_bar<span class="op">=</span><span class="fu">Val</span>(<span class="cn">false</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 59.458707 seconds (153 allocations: 288.109 MiB, 0.11% gc time)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Solution of time evolution
(return code: Success)
--------------------------
num_states = 1
num_expect = 1
ODE alg.: OrdinaryDiffEqTsit5.Tsit5{typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!), Static.False}(OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, static(false))
abstol = 1.0e-8
reltol = 1.0e-6</code></pre>
</div>
</div>
<p>We observe that the simulation runs quite slowly. In the next section, we will leverage GPU acceleration using <a href="https://github.com/JuliaGPU/CUDA.jl">CUDA.jl</a>, which is seamlessly integrated into QuantumToolbox.jl.</p>
</section>
<section id="simulation-of-the-master-equation-on-the-gpu" class="level3">
<h3 class="anchored" data-anchor-id="simulation-of-the-master-equation-on-the-gpu">Simulation of the master equation on the GPU</h3>
<p>To run on the GPU using CUDA.jl, we only need to convert the <code>QuantumObject</code>s using the <code>cu</code> function.</p>
<div id="20" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1"></a><span class="im">using</span> <span class="bu">CUDA</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>CUDA.<span class="fu">allowscalar</span>(<span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1"></a>L_gpu <span class="op">=</span> <span class="fu">cu</span>(L)</span>
<span id="cb20-2"><a href="#cb20-2"></a>ψ<span class="fl">0</span>_gpu <span class="op">=</span> <span class="fu">cu</span>(ψ<span class="fl">0</span>)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>e_ops_gpu <span class="op">=</span> <span class="fu">cu</span>.(e_ops)</span>
<span id="cb20-5"><a href="#cb20-5"></a></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="fu">mesolve</span>(L_gpu, ψ<span class="fl">0</span>_gpu, tlist[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>], e_ops<span class="op">=</span>e_ops_gpu, progress_bar<span class="op">=</span><span class="fu">Val</span>(<span class="cn">false</span>)) <span class="co"># warm-up</span></span>
<span id="cb20-7"><a href="#cb20-7"></a></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="pp">@time</span> result_gpu <span class="op">=</span> <span class="fu">mesolve</span>(L_gpu, ψ<span class="fl">0</span>_gpu, tlist, e_ops<span class="op">=</span>e_ops_gpu, progress_bar<span class="op">=</span><span class="fu">Val</span>(<span class="cn">false</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  1.502146 seconds (522.61 k allocations: 9.563 MiB)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Solution of time evolution
(return code: Success)
--------------------------
num_states = 1
num_expect = 1
ODE alg.: OrdinaryDiffEqTsit5.Tsit5{typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!), Static.False}(OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, static(false))
abstol = 1.0e-8
reltol = 1.0e-6</code></pre>
</div>
</div>
<p>And we can plot the results of both CPU and GPU simulations.</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1"></a>fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">700</span>, <span class="fl">300</span>), fontsize<span class="op">=</span><span class="fl">20</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"Time"</span>, ylabel<span class="op">=</span>L<span class="st">"\langle \hat{\sigma}_z </span><span class="sc">\r</span><span class="st">angle"</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="fu">lines!</span>(ax, result.times, <span class="fu">real</span>.(result.expect[<span class="fl">1</span>,<span class="op">:</span>]), linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">"CPU"</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="fu">lines!</span>(ax, result_gpu.times, <span class="fu">real</span>.(result_gpu.expect[<span class="fl">1</span>,<span class="op">:</span>]), linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">"GPU"</span>, linestyle<span class="op">=:</span>dash)</span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="fu">axislegend</span>(ax)</span>
<span id="cb23-8"><a href="#cb23-8"></a></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="fu">xlims!</span>(ax, result.times[<span class="fl">1</span>], result.times[<span class="kw">end</span>])</span>
<span id="cb23-10"><a href="#cb23-10"></a></span>
<span id="cb23-11"><a href="#cb23-11"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="introduction_files/figure-html/cell-13-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="massive-parallelization-of-quantum-trajectories" class="level2">
<h2 class="anchored" data-anchor-id="massive-parallelization-of-quantum-trajectories">Massive Parallelization of quantum trajectories</h2>
<p>The master equation is a deterministic evolution of the density matrix, but it is not the only way to simulate the dynamics of an open quantum system. In many cases, it is more useful to use Monte Carlo quantum trajectories. In each trajectory, the system is in a pure state and evolves according to the Schrödinger equation</p>
<p><span class="math display">\[
i \frac{d}{d t} \vert \psi(t) \rangle = \hat{H}_\mathrm{eff} \vert \psi(t) \rangle \, ,
\]</span></p>
<p>where <span class="math inline">\(\hat{H}_\mathrm{eff}\)</span> is the effective Hamiltonian</p>
<p><span class="math display">\[
\hat{H}_\mathrm{eff} = \hat{H} - \frac{i}{2} \sum_k \hat{L}_k^\dagger \hat{L}_k \, .
\]</span></p>
<p>Thus, the state evolves following a non-unitary evolution, and its norm decreases in time. When the norm reaches a randomly generated threshold <span class="math inline">\(r\)</span>, a quantum jump occurs, and the new state becomes</p>
<p><span class="math display">\[
\vert \psi(t + dt) \rangle \to \frac{\hat{L}_k \vert \psi(t) \rangle}{\sqrt{\langle \psi(t) \vert \hat{L}_k^\dagger \hat{L}_k \vert \psi(t) \rangle}} \, .
\]</span></p>
<p>By averaging over many trajectories, we converge to the solution of the master equation in <a href="#eq-master-equation" class="quarto-xref">Equation&nbsp;2</a>. The code is more or less the same as before, but we need to use the <code>mcsolve</code> function instead of <code>mesolve</code>.</p>
<p>In general, the Monte Carlo method scales better with the Hilbert space dimension. To give an example, let’s consider a 4x4 transverse field Ising model with 16 spins and periodi boundary conditions. Here we use the <a href="https://qutip.org/QuantumToolbox.jl/stable/resources/api#QuantumToolbox.Lattice"><code>Lattice</code></a> struct and the <a href="https://qutip.org/QuantumToolbox.jl/stable/resources/api#QuantumToolbox.DissipativeIsing"><code>DissipativeIsing</code></a> function to easily generate the Hamiltonian and the dissipators.</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Define lattice</span></span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a>Nx <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>Ny <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>latt <span class="op">=</span> <span class="fu">Lattice</span>(Nx <span class="op">=</span> Nx, Ny <span class="op">=</span> Ny)</span>
<span id="cb24-6"><a href="#cb24-6"></a></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="co"># Define Hamiltonian and collapse operators</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>Jx <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>Jy <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>Jz <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>hx <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>hy <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb24-13"><a href="#cb24-13"></a>hz <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb24-14"><a href="#cb24-14"></a>γ <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb24-15"><a href="#cb24-15"></a></span>
<span id="cb24-16"><a href="#cb24-16"></a>Sx <span class="op">=</span> <span class="fu">mapreduce</span>(<span class="fu">i-&gt;SingleSiteOperator</span>(<span class="fu">sigmax</span>(), i, latt), <span class="op">+</span>, <span class="fl">1</span><span class="op">:</span>latt.N)</span>
<span id="cb24-17"><a href="#cb24-17"></a>Sy <span class="op">=</span> <span class="fu">mapreduce</span>(<span class="fu">i-&gt;SingleSiteOperator</span>(<span class="fu">sigmay</span>(), i, latt), <span class="op">+</span>, <span class="fl">1</span><span class="op">:</span>latt.N)</span>
<span id="cb24-18"><a href="#cb24-18"></a>Sz <span class="op">=</span> <span class="fu">mapreduce</span>(<span class="fu">i-&gt;SingleSiteOperator</span>(<span class="fu">sigmaz</span>(), i, latt), <span class="op">+</span>, <span class="fl">1</span><span class="op">:</span>latt.N)</span>
<span id="cb24-19"><a href="#cb24-19"></a></span>
<span id="cb24-20"><a href="#cb24-20"></a>H, c_ops <span class="op">=</span> <span class="fu">DissipativeIsing</span>(Jx, Jy, Jz, hx, hy, hz, γ, latt; boundary_condition <span class="op">=</span> <span class="fu">Val</span>(<span class="op">:</span>periodic_bc), order <span class="op">=</span> <span class="fl">1</span>)</span>
<span id="cb24-21"><a href="#cb24-21"></a>e_ops <span class="op">=</span> [Sx, Sy, Sz]</span>
<span id="cb24-22"><a href="#cb24-22"></a></span>
<span id="cb24-23"><a href="#cb24-23"></a><span class="co"># Time Evolution</span></span>
<span id="cb24-24"><a href="#cb24-24"></a></span>
<span id="cb24-25"><a href="#cb24-25"></a>ψ<span class="fl">0</span> <span class="op">=</span> <span class="fu">fock</span>(<span class="fl">2</span><span class="op">^</span>latt.N, <span class="fl">0</span>, dims <span class="op">=</span> <span class="fu">ntuple</span>(i<span class="op">-&gt;</span><span class="fl">2</span>, <span class="fu">Val</span>(latt.N)))</span>
<span id="cb24-26"><a href="#cb24-26"></a></span>
<span id="cb24-27"><a href="#cb24-27"></a>tlist <span class="op">=</span> <span class="fu">range</span>(<span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">100</span>)</span>
<span id="cb24-28"><a href="#cb24-28"></a></span>
<span id="cb24-29"><a href="#cb24-29"></a>ntraj <span class="op">=</span> <span class="fl">100</span></span>
<span id="cb24-30"><a href="#cb24-30"></a></span>
<span id="cb24-31"><a href="#cb24-31"></a><span class="fu">mcsolve</span>(H, ψ<span class="fl">0</span>, tlist[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>], c_ops, e_ops<span class="op">=</span>e_ops, ntraj<span class="op">=</span><span class="bu">Threads</span>.<span class="fu">nthreads</span>(), progress_bar<span class="op">=</span><span class="fu">Val</span>(<span class="cn">false</span>)) <span class="co"># warm-up</span></span>
<span id="cb24-32"><a href="#cb24-32"></a></span>
<span id="cb24-33"><a href="#cb24-33"></a><span class="pp">@time</span> sol_mc <span class="op">=</span> <span class="fu">mcsolve</span>(H, ψ<span class="fl">0</span>, tlist, c_ops, e_ops<span class="op">=</span>e_ops, ntraj<span class="op">=</span>ntraj, progress_bar<span class="op">=</span><span class="fu">Val</span>(<span class="cn">false</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 53.707800 seconds (15.67 k allocations: 4.625 GiB, 0.87% gc time)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Solution of quantum trajectories
(converged: true)
--------------------------------
num_trajectories = 100
num_states = 1
num_expect = 3
ODE alg.: OrdinaryDiffEqTsit5.Tsit5{typeof(OrdinaryDiffEqCore.trivial_limiter!), typeof(OrdinaryDiffEqCore.trivial_limiter!), Static.False}(OrdinaryDiffEqCore.trivial_limiter!, OrdinaryDiffEqCore.trivial_limiter!, static(false))
abstol = 1.0e-8
reltol = 1.0e-6</code></pre>
</div>
</div>
<p>Despite integrating over a short time and the small number of trajectories, we can see that the simulation is very slow, due to the huge Hilbert space dimension. However, we can leverage the massive parallelization on a cluster, thanks to the <a href="https://docs.julialang.org/en/v1/manual/distributed-computing/">Distributed.jl</a> and <a href="https://github.com/JuliaParallel/ClusterManagers.jl">ClusterManagers.jl</a> packages. With QuantumToolbox.jl, we can easily distribute the computation over multiple nodes. The following examples are applied to a cluster with the <a href="https://slurm.schedmd.com/documentation.html">SLURM</a> workload manager.</p>
<p>We start by creating a file named <code>run.batch</code> with the following content:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co">#SBATCH --output=output.out</span></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co">#SBATCH --nodes=20</span></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co">#SBATCH --ntasks-per-node=1</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="co">#SBATCH --cpus-per-task=72</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="co">#SBATCH --time=0:10:00</span></span>
<span id="cb27-7"><a href="#cb27-7"></a></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="co"># Set PATH to include the directory of your custom Julia installation</span></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="bu">export</span> <span class="va">PATH</span><span class="op">=</span>/home/username/.juliaup/bin:<span class="va">$PATH</span></span>
<span id="cb27-10"><a href="#cb27-10"></a></span>
<span id="cb27-11"><a href="#cb27-11"></a><span class="co"># Now run Julia</span></span>
<span id="cb27-12"><a href="#cb27-12"></a><span class="ex">julia</span> <span class="at">--project</span> script.jl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where we have to replace <code>username</code> with the name of your account. This script will be used to submit the job to the cluster. Here, we are requesting 20 nodes with 72 threads each (1440 parallel jobs).</p>
<p>The <code>script.jl</code> contains the following content:</p>
<div id="28" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1"></a><span class="im">using</span> <span class="bu">Distributed</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="im">using</span> <span class="bu">ClusterManagers</span></span>
<span id="cb28-3"><a href="#cb28-3"></a></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="kw">const</span> SLURM_NUM_TASKS <span class="op">=</span> <span class="fu">parse</span>(<span class="dt">Int</span>, <span class="cn">ENV</span>[<span class="st">"SLURM_NTASKS"</span>])</span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="kw">const</span> SLURM_CPUS_PER_TASK <span class="op">=</span> <span class="fu">parse</span>(<span class="dt">Int</span>, <span class="cn">ENV</span>[<span class="st">"SLURM_CPUS_PER_TASK"</span>])</span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a>exeflags <span class="op">=</span> [<span class="st">"--project=."</span>, <span class="st">"-t </span><span class="sc">$</span>SLURM_CPUS_PER_TASK<span class="st">"</span>]</span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="fu">addprocs</span>(<span class="fu">SlurmManager</span>(SLURM_NUM_TASKS); exeflags<span class="op">=</span>exeflags, topology<span class="op">=:</span>master_worker)</span>
<span id="cb28-9"><a href="#cb28-9"></a></span>
<span id="cb28-10"><a href="#cb28-10"></a></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="fu">println</span>(<span class="st">"################"</span>)</span>
<span id="cb28-12"><a href="#cb28-12"></a><span class="fu">println</span>(<span class="st">"Hello! You have </span><span class="sc">$</span>(<span class="fu">nworkers</span>())<span class="st"> workers with </span><span class="sc">$</span>(<span class="fu">remotecall_fetch</span>(<span class="bu">Threads</span>.nthreads, <span class="fl">2</span>))<span class="st"> threads each."</span>)</span>
<span id="cb28-13"><a href="#cb28-13"></a></span>
<span id="cb28-14"><a href="#cb28-14"></a><span class="fu">println</span>(<span class="st">"----------------"</span>)</span>
<span id="cb28-15"><a href="#cb28-15"></a></span>
<span id="cb28-16"><a href="#cb28-16"></a></span>
<span id="cb28-17"><a href="#cb28-17"></a><span class="fu">println</span>(<span class="st">"################"</span>)</span>
<span id="cb28-18"><a href="#cb28-18"></a></span>
<span id="cb28-19"><a href="#cb28-19"></a><span class="fu">flush</span>(<span class="cn">stdout</span>)</span>
<span id="cb28-20"><a href="#cb28-20"></a></span>
<span id="cb28-21"><a href="#cb28-21"></a><span class="pp">@everywhere</span> <span class="cf">begin</span></span>
<span id="cb28-22"><a href="#cb28-22"></a>    <span class="im">using</span> <span class="bu">QuantumToolbox</span></span>
<span id="cb28-23"><a href="#cb28-23"></a>    <span class="im">using</span> <span class="bu">OrdinaryDiffEq</span></span>
<span id="cb28-24"><a href="#cb28-24"></a></span>
<span id="cb28-25"><a href="#cb28-25"></a>    BLAS.<span class="fu">set_num_threads</span>(<span class="fl">1</span>)</span>
<span id="cb28-26"><a href="#cb28-26"></a><span class="cf">end</span></span>
<span id="cb28-27"><a href="#cb28-27"></a></span>
<span id="cb28-28"><a href="#cb28-28"></a><span class="co"># ...</span></span>
<span id="cb28-29"><a href="#cb28-29"></a><span class="co"># Define the Hamiltonian and collapse operators as in the previous example</span></span>
<span id="cb28-30"><a href="#cb28-30"></a><span class="co"># ...</span></span>
<span id="cb28-31"><a href="#cb28-31"></a></span>
<span id="cb28-32"><a href="#cb28-32"></a>tlist <span class="op">=</span> <span class="fu">range</span>(<span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">100</span>) <span class="co"># longer time evolution</span></span>
<span id="cb28-33"><a href="#cb28-33"></a>ntraj <span class="op">=</span> <span class="fl">5000</span></span>
<span id="cb28-34"><a href="#cb28-34"></a></span>
<span id="cb28-35"><a href="#cb28-35"></a>sol_mc <span class="op">=</span> <span class="fu">mcsolve</span>(H, ψ<span class="fl">0</span>, tlist, c_ops, e_ops<span class="op">=</span>e_ops, ntraj<span class="op">=</span><span class="fl">5000</span>, ensemble_method<span class="op">=</span><span class="fu">EnsembleSplitThreads</span>())</span>
<span id="cb28-36"><a href="#cb28-36"></a></span>
<span id="cb28-37"><a href="#cb28-37"></a><span class="fu">println</span>(<span class="st">"FINISH!"</span>)</span>
<span id="cb28-38"><a href="#cb28-38"></a></span>
<span id="cb28-39"><a href="#cb28-39"></a><span class="fu">rmprocs</span>(<span class="fu">workers</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Where we used the keyword argument <code>ensemble_method=EnsembleSplitThreads()</code> to distribute the computation over multiple nodes. After running the <code>run.batch</code> script, we can check the output file <code>output.out</code> to see the results.</p>
<pre><code>################
Hello! You have 20 workers with 72 threads each.
----------------
################

Progress: [==============================] 100.0% --- Elapsed Time: 0h 04m 50s (ETA: 0h 00m 00s)

FINISH!</code></pre>
</section>
<section id="visualization-of-quantum-states" class="level2">
<h2 class="anchored" data-anchor-id="visualization-of-quantum-states">Visualization of Quantum States</h2>
<p>QuantumToolbox.jl provides a simple way to visualize quantum states using the Wigner function. Given a quantum state defined by the density matrix <span class="math inline">\(\hat{\rho}\)</span>, the Wigner function is defined as</p>
<p><span class="math display">\[
W(x, p) = \frac{1}{\pi} \int_{-\infty}^{+\infty} dy \ e^{2ipy} \left\langle x + y \right| \hat{\rho} \left| x - y \right\rangle \, ,
\]</span></p>
<p>which can be seen as a quasi-probability distribution in phase space. As a first example, let’s consider a coherent state</p>
<p><span class="math display">\[
\vert \alpha \rangle = e^{-\frac{1}{2} \vert \alpha \vert^2} \sum_{n=0}^\infty \frac{\alpha^n}{\sqrt{n!}} \vert n \rangle \, ,
\]</span></p>
<p>which is the most classical-like quantum state. The Wigner function of a coherent state is a Gaussian centered at the point <span class="math inline">\((\text{Re}(\alpha), \text{Im}(\alpha))\)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Let’s plot the Wigner function of a coherent state with <span class="math inline">\(\alpha = 1 + 2i\)</span>.</p>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1"></a>N <span class="op">=</span> <span class="fl">50</span> <span class="co"># Cutoff for Fock states</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>α <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">2im</span></span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a>ψ <span class="op">=</span> <span class="fu">coherent</span>(N, α)</span>
<span id="cb30-5"><a href="#cb30-5"></a></span>
<span id="cb30-6"><a href="#cb30-6"></a>x <span class="op">=</span> <span class="fu">range</span>(<span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">200</span>)</span>
<span id="cb30-7"><a href="#cb30-7"></a>p <span class="op">=</span> <span class="fu">range</span>(<span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">200</span>)</span>
<span id="cb30-8"><a href="#cb30-8"></a></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="co"># g is the normalization factor. g=2 ensures that the position of the peak is at the point (Re(α), Im(α))</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>W <span class="op">=</span> <span class="fu">wigner</span>(ψ, x, p, g<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a>vmax <span class="op">=</span> <span class="fu">max</span>(<span class="fu">maximum</span>(abs, W), <span class="fu">minimum</span>(abs, W))</span>
<span id="cb30-13"><a href="#cb30-13"></a></span>
<span id="cb30-14"><a href="#cb30-14"></a>fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">700</span>, <span class="fl">600</span>), fontsize<span class="op">=</span><span class="fl">20</span>)</span>
<span id="cb30-15"><a href="#cb30-15"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span>L<span class="st">"\Re(</span><span class="sc">\a</span><span class="st">lpha)"</span>, ylabel<span class="op">=</span>L<span class="st">"\Im(</span><span class="sc">\a</span><span class="st">lpha)"</span>)</span>
<span id="cb30-16"><a href="#cb30-16"></a></span>
<span id="cb30-17"><a href="#cb30-17"></a>img <span class="op">=</span> <span class="fu">heatmap!</span>(ax, x, p, W<span class="op">'</span>, interpolate<span class="op">=</span><span class="cn">true</span>, rasterize<span class="op">=</span><span class="fl">2</span>, colorrange<span class="op">=</span>(<span class="op">-</span>vmax, vmax), colormap<span class="op">=:</span>seismic)</span>
<span id="cb30-18"><a href="#cb30-18"></a></span>
<span id="cb30-19"><a href="#cb30-19"></a><span class="fu">Colorbar</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], img)</span>
<span id="cb30-20"><a href="#cb30-20"></a></span>
<span id="cb30-21"><a href="#cb30-21"></a><span class="fu">colsize!</span>(fig.layout, <span class="fl">1</span>, <span class="fu">Aspect</span>(<span class="fl">1</span>, <span class="fl">1</span>))</span>
<span id="cb30-22"><a href="#cb30-22"></a></span>
<span id="cb30-23"><a href="#cb30-23"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="introduction_files/figure-html/cell-16-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Let’s now consider the Schrödinger cat state</p>
<p><span class="math display">\[
\vert \mathcal{C}_\alpha^+ \rangle = \frac{1}{N_\alpha^+} \left( \vert \alpha \rangle + \vert -\alpha \rangle \right) \, ,
\]</span></p>
<p>where <span class="math inline">\(N_\alpha^+\)</span> is a normalization factor, and <span class="math inline">\(\vert \alpha \rangle\)</span> is a coherent state. This state can be seen as a quantum superposition of two macroscopically distinct states (like in the Schrödinger’s cat thought experiment). The Wigner function now is totally different</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1"></a>ψ_cat <span class="op">=</span> <span class="fu">coherent</span>(N, α) <span class="op">+</span> <span class="fu">coherent</span>(N, <span class="op">-</span>α) <span class="op">|&gt;</span> normalize</span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a>W_cat <span class="op">=</span> <span class="fu">wigner</span>(ψ_cat, x, p, g<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a>vmax <span class="op">=</span> <span class="fu">max</span>(<span class="fu">maximum</span>(abs, W_cat), <span class="fu">minimum</span>(abs, W_cat))</span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a>fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">700</span>, <span class="fl">600</span>), fontsize<span class="op">=</span><span class="fl">20</span>)</span>
<span id="cb31-8"><a href="#cb31-8"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span>L<span class="st">"\Re(</span><span class="sc">\a</span><span class="st">lpha)"</span>, ylabel<span class="op">=</span>L<span class="st">"\Im(</span><span class="sc">\a</span><span class="st">lpha)"</span>)</span>
<span id="cb31-9"><a href="#cb31-9"></a></span>
<span id="cb31-10"><a href="#cb31-10"></a>img <span class="op">=</span> <span class="fu">heatmap!</span>(ax, x, p, W_cat<span class="op">'</span>, interpolate<span class="op">=</span><span class="cn">true</span>, rasterize<span class="op">=</span><span class="fl">2</span>, colorrange<span class="op">=</span>(<span class="op">-</span>vmax, vmax), colormap<span class="op">=:</span>seismic)</span>
<span id="cb31-11"><a href="#cb31-11"></a></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="fu">Colorbar</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], img)</span>
<span id="cb31-13"><a href="#cb31-13"></a></span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="fu">colsize!</span>(fig.layout, <span class="fl">1</span>, <span class="fu">Aspect</span>(<span class="fl">1</span>, <span class="fl">1</span>))</span>
<span id="cb31-15"><a href="#cb31-15"></a></span>
<span id="cb31-16"><a href="#cb31-16"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="introduction_files/figure-html/cell-17-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Where the interference fringes are a signature of the “<em>quantumness</em>” of the state.</p>
<section id="gpu-acceleration-for-the-wigner-function" class="level3">
<h3 class="anchored" data-anchor-id="gpu-acceleration-for-the-wigner-function">GPU Acceleration for the Wigner function</h3>
<p>Sometimes, the state for which we want to compute the Wigner function is very large, and the computation can be slow. QuantumToolbox.jl provides a GPU-accelerated version of the Wigner function computation, which can be used by simply converting the phase space coordinates to the GPU.</p>
<p>If we increase the Hilbert space dimension to <span class="math inline">\(N = 120\)</span>, and we increase the number of points in the phase space to <span class="math inline">\(500 \times 500\)</span>, the computation can be slow on the CPU.</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1"></a>N <span class="op">=</span> <span class="fl">120</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>α <span class="op">=</span> <span class="fl">5</span> <span class="op">+</span> <span class="fl">7im</span></span>
<span id="cb32-3"><a href="#cb32-3"></a></span>
<span id="cb32-4"><a href="#cb32-4"></a>ψ_cat <span class="op">=</span> <span class="fu">coherent</span>(N, α) <span class="op">+</span> <span class="fu">coherent</span>(N, <span class="op">-</span>α) <span class="op">|&gt;</span> normalize</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a>x <span class="op">=</span> <span class="fu">range</span>(<span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">500</span>)</span>
<span id="cb32-7"><a href="#cb32-7"></a>p <span class="op">=</span> <span class="fu">range</span>(<span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">500</span>)</span>
<span id="cb32-8"><a href="#cb32-8"></a></span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="pp">@time</span> <span class="fu">wigner</span>(ψ_cat, x, p, g<span class="op">=</span><span class="fl">2</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  3.698704 seconds (281 allocations: 42.305 MiB)</code></pre>
</div>
</div>
<p>And on the GPU</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1"></a>x_gpu <span class="op">=</span> <span class="fu">CuVector</span>(<span class="fu">collect</span>(x))</span>
<span id="cb34-2"><a href="#cb34-2"></a>p_gpu <span class="op">=</span> <span class="fu">CuVector</span>(<span class="fu">collect</span>(p))</span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="fu">wigner</span>(ψ_cat, x_gpu, p_gpu, g<span class="op">=</span><span class="fl">2</span>); <span class="co"># warm-up</span></span>
<span id="cb34-5"><a href="#cb34-5"></a></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="pp">@time</span> <span class="fu">wigner</span>(ψ_cat, x_gpu, p_gpu, g<span class="op">=</span><span class="fl">2</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  0.233684 seconds (994.25 k allocations: 16.398 MiB)</code></pre>
</div>
</div>
</section>
</section>
<section id="current-features" class="level2">
<h2 class="anchored" data-anchor-id="current-features">Current features</h2>
<p>The <code>QuantumToolbox.jl</code> package has already several features: - <code>QuantumObject</code> construct that supports any type of arrays (dense, sparse, <a href="https://github.com/JuliaArrays/StaticArrays.jl">StaticArrays.jl</a>, <a href="https://github.com/JuliaGPU/CUDA.jl">CUDA.jl</a>, <a href="https://github.com/JuliaGPU/oneAPI.jl">oneAPI.jl</a>, <a href="https://github.com/JuliaGPU/Metal.jl">Metal.jl</a>, <a href="https://github.com/JuliaParallel/DistributedArrays.jl">DistributedArrays.jl</a>, …) - Most of the basic operations on quantum operators and states (linear algebra operations, eigenvalues, partial trace, …) - Visualization of quantum states using Wigner functions, with also support for GPU acceleration - Support for the basic time evolution solvers (<code>sesolve</code>, <code>mesolve</code>, <code>mcsolve</code>) with both support for multithreading and distributed computing - Stochastic solvers (homodyne and heterodyne detection) - Support for almost any kind of callbacks during time evolution, thorugh the <code>DiffEqCallbacks.jl</code> package. See, e.g.&nbsp;<em>Dynamical Shifted Fock</em> or <em>Dynamical Fock Dimension</em> time evolutions - Easy calculation of steadystate - Krylov Subspace support for fast linear algebra operations (GPU still supported) - Emission spectrum with both FFT and semi-analytical methods - Entanglement calculation - Detection of symmetries and block-diagonal forms of both operators and superoperators</p>
<p>However, there is still a lot of work to do:</p>
<ul>
<li>Extending the number of solvers</li>
<li>Support for other quasi-probability distributions, e.g., Husimi Q-function</li>
<li>Documentation!!</li>
<li>Many others…</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Contributions are welcome! If you are interested in contributing to the project, please check the <a href="https://github.com/qutip/QuantumToolbox.jl">GitHub repository</a>.</p>
</div>
</div>
<hr>
</section>
<section id="system-information" class="level2">
<h2 class="anchored" data-anchor-id="system-information">System Information</h2>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1"></a><span class="im">using</span> <span class="bu">InteractiveUtils</span></span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="fu">versioninfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Julia Version 1.11.1
Commit 8f5b7ca12ad (2024-10-16 10:53 UTC)
Build Info:
  Official https://julialang.org/ release
Platform Info:
  OS: Linux (x86_64-linux-gnu)
  CPU: 32 × 13th Gen Intel(R) Core(TM) i9-13900KF
  WORD_SIZE: 64
  LLVM: libLLVM-16.0.6 (ORCJIT, alderlake)
Threads: 16 default, 0 interactive, 8 GC (on 32 virtual cores)
Environment:
  JULIA_PYTHONCALL_EXE = ../pyenv/bin/python
  LD_LIBRARY_PATH = /usr/local/lib:
  JULIA_NUM_THREADS = 16
  JULIA_CONDAPKG_BACKEND = Null
  JULIA_LOAD_PATH = @:@stdlib</code></pre>
</div>
</div>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1"></a>CUDA.<span class="fu">versioninfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CUDA runtime 12.6, artifact installation
CUDA driver 12.4
NVIDIA driver 550.120.0

CUDA libraries: 
- CUBLAS: 12.6.4
- CURAND: 10.3.7
- CUFFT: 11.3.0
- CUSOLVER: 11.7.1
- CUSPARSE: 12.5.4
- CUPTI: 2024.3.2 (API 24.0.0)
- NVML: 12.0.0+550.120

Julia packages: 
- CUDA: 5.5.2
- CUDA_Driver_jll: 0.10.4+0
- CUDA_Runtime_jll: 0.15.5+0

Toolchain:
- Julia: 1.11.1
- LLVM: 16.0.6

1 device:
  0: NVIDIA GeForce RTX 4090 (sm_89, 20.232 GiB / 23.988 GiB available)</code></pre>
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Up to a normalization factor<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/albertomercurio\.github\.io\/Lectures\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>